'use strict';

Object.defineProperty(exports, '__esModule', { value: true });

var index = require('../symbols/index.cjs');
var deferred = require('../utils/deferred.cjs');

const readyMap = new Map();
const initializersMap = new Map();
/**
 * Used to mark a Service method to be called after all the Services are created, but before the server starts
 *
 * @param dependencies The dependencies that need to be initialized before this one will be
 */
function Initializer(dependencies = []) {
    return (targetPrototype, propertyKey) => {
        const target = targetPrototype.constructor;
        const ready = new deferred.Deferred();
        target[index.INITIALIZER] = (self) => {
            return Promise.all(dependencies.map((dep) => initializersMap.get(dep)))
                .then(() => self[propertyKey]())
                .then(ready.resolve)
                .catch(ready.reject);
        };
        initializersMap.set(target, ready.promise);
    };
}

exports.Initializer = Initializer;
exports.initializersMap = initializersMap;
exports.readyMap = readyMap;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjpudWxsLCJzb3VyY2VzIjpbbnVsbF0sInNvdXJjZXNDb250ZW50IjpbbnVsbF0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esb0JBQW9CLHNCQUFxQjtBQUN6Qyx1QkFBdUIsdUJBQXNCO0FBQzdDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOyJ9
